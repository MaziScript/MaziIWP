<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="utf-8" />
	<title>MaziScript 在线写作平台</title>
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="css/editormd.css" />
	<link rel="shortcut icon" href="https://pandao.github.io/editor.md/favicon.ico" type="image/x-icon" />
</head>

<body>
	<div id="layout">
		<header>
			<h1>MaziScript 在线写作平台</h1>
		</header>

		<br />

		<div id="test-editormd">
			<textarea style="display:none;"></textarea>
		</div>
	</div>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="editormd.js"></script>

    <!-- Editor基本参数 -->
    <script type="text/javascript">
			var testEditor;

            $(function() {
                testEditor = editormd("test-editormd", {
                    width           : "90%",
                    height          : 640,
                    path            : "lib/",
                    emoji           : true,
                    taskList        : true,
                    flowChart       : true, 
                    sequenceDiagram : true,

                    toolbarIcons : function(){
                        return ["mazi_submit", "mazi_save", "mazi_open", "|", 
                                "undo", "redo", "|", 
                                "bold", "del", "italic", "quote", "|", 
                                "list-ul", "list-ol", "hr", "|",
                                "link", "reference-link", "image",  "table", "datetime", "emoji", "html-entities", "|",
                                "goto-line", "watch", "preview", "fullscreen", "clear", "search", "|",
                                "help", "info"];
                    },
                    toolbarIconsClass :{
                        mazi_submit : "fa-check",
                        mazi_save   : "fa-save",
                        mazi_open   : "fa-folder-open"
                    },
                    toolbarHandlers : {
                        mazi_submit : function(){
                            //this.executePlugin("submit", "/");
                        },
                        mazi_save : function(){
                            //TODO: 保存
                        },
                        mazi_open : function(){
                            //TODO: 打开
                            $("#maziUpload").click();
                        }
                    },
                    lang: {
                        toolbar: {
                            mazi_submit : "完成写作",
                            mazi_save   : "提交保存",
                            mazi_open   : "打开作品"
                        }
                    },

                    placeholder     : "试着写些什么……"
                });
            });
    </script>

    <input type="file" id="maziUpload" style="display:none">
    <script type="text/javascript" src="lib/jszip.js"></script>
    <script type="text/javascript" src="lib/jszip-utils.js"></script>
    <script type="text/javascript" src="js/zipMazi.js"></script>
    <script type="text/javascript" src="js/errMazi.js"></script>
    <script type="text/javascript">
        $("document").ready(function(){
            $("#maziUpload").change(function(evt) {
                var file = evt.target.files[0];

                var load = loadZip(file);
                var zipContent;

                load.then(function(zip){
                    zipContent = zip;
                    return zip;
                })
                .then(getMaziInfoJson)
                .then(function(maziInfo){
                    console.log(maziInfo);

                    var a = getMaziChapterNameList(maziInfo);
                    var b = getMaziChapterFileNameList(maziInfo);

                    console.log(a);
                    console.log(b);
                })
                
                /*
                getMaziInfoJson(file).then(
                    function(result){
                        var info = JSON.parse(result);

                        var chapter = getMaziChapterFileNameList(info);

                        for(var i in chapter){
                            getMaziChapterJson(file, chapter[i]).then(
                                function(result){
                                    if(typeof result != "undefined"){
                                        var cp = JSON.parse(result);
                                    }
                                    console.log(cp);
                                }
                            );
                        }
                    }
                );
                */
            });
        });
    </script>

</body>

</html>